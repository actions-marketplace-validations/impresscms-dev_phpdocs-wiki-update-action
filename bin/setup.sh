#!/usr/bin/env bash

ENGINE="$1"

ACTION_SUFFIX="${GITHUB_SHA}-${GITHUB_RUN_ID}-${GITHUB_RUN_ATTEMPT}"
OLD_WIKI_CHECKOUT_PATH="${RUNNER_TEMP}/old-wiki-${ACTION_SUFFIX}"
NEW_WIKI_CHECKOUT_PATH="${RUNNER_TEMP}/new-wiki-${ACTION_SUFFIX}"
ACTION_BIN_PATH="${GITHUB_ACTION_PATH}/bin"
NEEDED_PHP_VERSION=$(bash ${GITHUB_ACTION_PATH}/bin/detect_needed_php.sh "$ENGINE")

echo "OLD_WIKI_CHECKOUT_PATH=$OLD_WIKI_CHECKOUT_PATH" >> $GITHUB_ENV
echo "NEW_WIKI_CHECKOUT_PATH=$NEW_WIKI_CHECKOUT_PATH" >> $GITHUB_ENV
echo "NEEDED_PHP_VERSION=$NEEDED_PHP_VERSION" >> $GITHUB_ENV
echo "ACTION_BIN_PATH=$ACTION_BIN_PATH" >> $GITHUB_ENV

bash "$ACTION_BIN_PATH/create_tmp_data.sh"